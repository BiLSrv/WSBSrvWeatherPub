<!doctype html>
<html>
<head>
<title>Online jQuery Editor</title>
<script src="https://www.tutorialspoint.com/jquery/jquery-3.6.0.js"></script>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js">
	</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-touch-events/2.0.0/jquery.mobile-events.min.js">
	</script>
<link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://rawgit.com/Mikhus/canvas-gauges/master/fonts/fonts.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<script src="https://rawgit.com/Mikhus/canvas-gauges/master/gauge.min.js"></script>
<script src="https://bilsrv.github.io/WSBSrvWeatherPub/GaugeMeter.js"></script>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>GaugeMeter.js - jQuery Plugin</title>
    <meta
      name="description"
      content="Easy to use gauge meter JavaScript plugin using jQuery"
    />
    <meta name="author" content="Mictronics" />
    <style>

body
{
 background-color:cyan
}

.noscroll { position: fixed;overflow:hidden; display: none;}

.overlay { 
   		overflow-y: scroll;
		}
.sb_nav
{
	background-color: darkslateblue;
}
.sidebar_sensor
{
	background-color:#A1A1A1;
}
.macnt
{
	background-color:#535157;
}
  .GaugeMeter{
    Position:        Relative;
    Text-Align:      Center;
    Overflow:        Hidden;
    Cursor:          Default;
  }
  /*.GaugeMeter::before
	{
	content: ' ';
	display: block;
	position: absolute;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	opacity: 0.6;
	background: #0070ad URL(https://bilsrv.github.io/WSBSrvWeatherPub/BokehFrost.jpg) Top Left No-Repeat;
    background-size: Cover;
	}
*/
  .GaugeMeter SPAN,
  .GaugeMeter B{
    Margin:          -20% 10%;
    Width:           80%;
    Position:        Absolute;
    Text-align:      Center;
    Display:         Inline-Block;
    Color:           RGBa(255,255,255,.8);
    Font-Weight:     300;
    Font-Family:     "Open Sans", Arial;
    Overflow:        Hidden;
    White-Space:     NoWrap;
    Text-Overflow:   Ellipsis;
  }
  .GaugeMeter[data-style="Semi"] B{
    Margin:          0% 10%;
    Width:           80%;
  }

  .GaugeMeter[data-style="Full"] B{
    Margin:          0% 10%;
    Width:           70%;
  }
			
  .GaugeMeter[data-style="Arch"] B{
    Margin:          0% 10%;
    Width:           70%;
  }
			
  .GaugeMeter S,
  .GaugeMeter U{
	Color:           Black;
    Text-Decoration: None;
    Font-Size:       .6em;
    Opacity:         1.0;
  }

  .GaugeMeter B{
    Color:           Black;
    Font-Weight:     400;
    Font-Size:       .8em;
    Opacity:         1.0;
  }

  .bd_fail 
  {
    border: 3px inset red;
	border-radius: 12px;
  }		
  
	  
    </style>


</head>
<body>
<br>
<!--upd1 3.3a		view-source:https://bilsrv.github.io/WSBSrvWeatherPub/WSB_page_main.html		-->
<meta charset="utf-8">
<br>
<form>
<div class="col-xs-3 mb-2 offset-lg-1 col-lg-3 offset-md-1 offset-sm-1 offset-1 col-5 col-sm-4 col-md-4 col-xl-3 px-2">
<button type="button" id="btn0" class="btn btn-primary" onclick="sub_init()">Открыть соед</button>
<button type="button" id="btn0" class="btn btn-primary" onclick="sub_grad()">Послать</button>
</div>
<div class=" offset-lg-0 col-lg-4 offset-sm-0 col-sm-5 col-6 offset-md-0 col-md-5 col-xl-3">
<span>Автозамер <input type="checkbox" class="form-check-input  ml-1" name="autmp" id="autmp" checked></span> 
<span>Автозапись <input type="checkbox" class="form-check-input  ml-1" name="autwrtemp" id="autwrtemp" checked></span> 	
</div>
<div class="container row text-center">
	<p class="h5 modal-title text-center">Средние значения датчиков</p>
					<div class="col-auto">
						<canvas data-type="radial-gauge" id="GauAvTemp"></canvas>
					</div>
					<div class="col-auto">
						<canvas data-type="radial-gauge" id="GauAvHum"></canvas>
					</div>
					<div class="col-auto">
						<canvas data-type="radial-gauge" id="GauAvPress"></canvas>
					</div>
					<div class="col-auto">
						<canvas data-type="radial-gauge" id="GauAirQ"></canvas>
					</div>
</div>
<div class="container row text-center">
					<p class="h5 modal-title text-center">Датчик LM75_1 и Датчик LM75_2</p>			  
					<div class="col-auto">
					<canvas class="canvasT" id="lm75_t1"></canvas>
					<label class="form-check-label" id="lm75_t1_lbl" for="lm75_t1_chk">Зап 1: <input class="form-check-input" id="lm75_t1_chk" type="checkbox"></label>	
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="lm75_t2"></canvas>
					<label class="form-check-label" id="lm75_t2_lbl" for="lm75_t2_chk">Зап 2:<input class="form-check-input" id="lm75_t2_chk" type="checkbox"></label>
	</div>
</div>
<div class="container row text-center">
				<p class="h5 modal-title text-center">Датчики BME280</p>
					<div class="col-auto">
					<canvas class="canvasT" id="bme280_1t"></canvas>
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="bme280_2t"></canvas>
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="sht35t"></canvas>
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="sht41t"></canvas>
					</div>
</div>
<div class="container row text-center">
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasH1" id="bme280_1h"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">bme280_1h</p>
						</div>
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasH1" id="bme280_2h"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">bme280_2h</p>
						</div>
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasH1" id="sht35h"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">sht35h</p>
						</div>
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasH1" id="sht41h"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">sht41h</p>
						</div>
</div>
<div class="container row text-center">
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasP1" id="bme280_1p"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">bme280_1p</p>
						</div>
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasP1" id="bme280_2p"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">bme280_2p</p>
						</div>
						<div class="col-auto">
							<canvas data-type="radial-gauge" class="canvasP1" id="bme680_1p"></canvas>
							<p class="text-center" id="aht21_h" style="width: 4rem;">bme680_1p</p>
						</div>
</div>
				<div class="form-group row">
					<div class="col-xs-6 offset-xl-1 col-xl-4 col-lg-3 offset-lg-1 offset-md-1 col-md-5">DEW_bme280:</div>
				  <div class="col-xs-3 col-md-3 offset-xl-2 offset-lg-2"><input type="text" class="form-control" id = "bme280_DEW" name="bme280_DEW" value=""></div>
				</div>					
				<div class="form-group row">
					<div class="col-xs-6 offset-xl-1 col-xl-4 col-lg-3 offset-lg-1 offset-md-1 col-md-5">QNH_bme280:</div>
				  <div class="col-xs-3 col-md-3 offset-xl-2 offset-lg-2"><input type="text" class="form-control" id = "bme280_QNH" name="bme280_QNH" value=""></div>
				</div>	
				<div class="form-group row">
					<div class="col-xs-6 offset-xl-1 col-xl-4 col-lg-3 offset-lg-1 offset-md-1 col-md-5">ALT_bme280:</div>
				  <div class="col-xs-3 col-md-3 offset-xl-2 offset-lg-2"><input type="text" class="form-control" id = "bme280_ALT" name="bme280_ALT" value=""></div>
				</div>					
</div>
<div class="container row text-center">
				<p class="h5 modal-title text-center">Датчик BME680</p>
					<div class="col-auto">
					<canvas class="canvasT" id="bme680_1t"></canvas>
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="aht21_t"></canvas>
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="ens160_t"></canvas>
					</div>
					<div class="col-auto">
					<canvas class="canvasT" id="lpshw_t"></canvas>
					</div>
</div>
<div class="container row text-center">
					<div class="col-auto">
						<canvas data-type="radial-gauge" class="canvasH1" id="bme680_1h"></canvas>
						<p class="text-center" id="bme680_1h" style="width: 4rem;">bme680_1h</p>
					</div>
					<div class="col-auto">
						<canvas data-type="radial-gauge" class="canvasH1" id="aht21_h"></canvas>
						<p class="text-center" id="aht21_h" style="width: 4rem;">aht21_h</p>
					</div>
					<div class="col-auto">
						<canvas data-type="radial-gauge" id="bme680_gr"></canvas>
							<p class="text-center" id="bme680_gr" style="width: 4rem;">bme680_gr</p>
						</div>
						
					</div>
</div>
<div class="container row text-center">
				<p class="h5 modal-title text-center">Датчик LPS35HW</p>
					<div class="col-auto">
						<canvas data-type="radial-gauge" class="canvasP1" id="lpshw_p"></canvas>
							<p class="text-center" id="lpshw_p" style="width: 4rem;">lpshw_p</p>
					</div>
</div>

<div class="container row text-center">
<p class="h5 modal-title text-center">Датчик ENS160</p>
					<div class="col-auto">
					<canvas data-type="radial-gauge" class="canvasH1" id="ens160_tempout"></canvas>
					</div>
					<div class="col-auto">
					<canvas data-type="radial-gauge" class="canvasH1" id="ens160_hout"></canvas>
						<p class="text-center" id="ens160_hout" style="width: 4rem;">ens160_hout</p>
					</div>
					<div class="col-auto">
					<canvas data-type="radial-gauge" id="ens160_tvoc"></canvas>
						<p class="text-center" id="ens160_tvoc" style="width: 4rem;">ens160_tvoc</p>
					</div>
					<div class="col-auto">
					<canvas data-type="radial-gauge" id="ens160_eco2"></canvas>
						<p class="text-center" id="ens160_eco2" style="width: 4rem;">ens160_eco2</p>
					</div>
					<div class="col-auto">
					<canvas data-type="radial-gauge" id="ens160_AIQ"></canvas>
						<p class="text-center" id="ens160_AIQ" style="width: 4rem;">ens160_AIQ</p>
					</div>
</div>
</div>
<div class="container row text-center">
				<p class="h5 modal-title text-center">Датчик CJMCU</p>
				<p class="text-primary fw-bold fs-5" id="CJMCU">НЕТ ДАННЫХ</p>
				<p class="h5 modal-title text-center">Данные АЦП</p>
				<div class="progress adc0per" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
				  <div class="progress-bar bg-success adc0" style="width: 25%">25%</div>
				</div>
				<div class="progress adc1per" role="progressbar" aria-label="Info example" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
				  <div class="progress-bar bg-info text-dark adc1" style="width: 50%">50%</div>
				</div>
				<div class="progress adc2per" role="progressbar" aria-label="Warning example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
				  <div class="progress-bar bg-warning text-dark adc2" style="width: 75%">75%</div>
				</div>
				<div class="progress adc3per" role="progressbar" aria-label="Default example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
				  <div class="progress-bar bg-danger adc3" style="width: 100%">100%</div>
				</div>
</div>
	<p class="h5 modal-title text-center">Доступность датчиков</p>
	<p class="h5 modal-title text-center REG_FAIL">Доступность датчиков</p>
   <button type="button" class="btn btn-secondary" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top" data-bs-content="Top popover" aria-describedby="popover452354"></button>
   <button type="button" class="btn btn-secondary" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top" data-bs-content="Top popover" aria-describedby="popover452354"></button>
</form>


<script>
// upda3a2
// https://bilsrv.github.io/WSBSrvWeatherPub/wsb_script_2_2_2.js
// reverse panelki dlya debug 
var sds, mds, sets, maOBJ, canvasOBJ, GuageMeterOBJ;
var httpd_cmd = 
{
	content_type: "application/json",
	command: ["get_data","get_sens"],
	CRC32: "ANY"
}
sds = $(".sideset");
mds = $(".macnt");
sets = $(".setcnt");
cnftmp = $(".scntf");
	
var CanvGaugeArr = [];
	
//$(document).ready(function() {
var gateway = 'wss://wsb.bilymo.keenetic.pro/ws'
/*
var gateway = 
{
		//gw:'wss://wsb.bilymo.keenetic.pro/ws',
		gw:'ws://wsb.bilymo.keenetic.pro/ws',
		timeout:2000,
		attempts: 60,		
		dataType: 'json',
		protocol:''
};
*/
var WSsocket;
var GuageMeter;


$('body').delay(500).queue(function() {
	
    //$(this).load('myPage.php');
WSsocket = new WebSocket(gateway);
// Canvas .each Default Settings 
$('canvas').each(function(index){	
    CanvGaugeArr.push(new LinearGauge({
    renderTo: $( this ).attr('id'),
    width: 100,
    height: 300,
	colorPlate: "black",
	colorUnits: "black",
	colorNeedle: "#222",
	colorNeedleEnd: "",
	colorBar: "#f5f5f5",
	colorTitle: "blue",
    colorPlate: "#ccc",
	colorPlateEnd: "#ccc",
	colorBarStroke: "black",
	borderRadius: "20",
	borders: "true",
	minValue: -50,
	maxValue: 50,
	minorTicks: 11,
	majorTicks: ['-50','-40','-30','-20','-10','0','10','20','30','40','50'],
    colorNumbers: ['cyan','blue','blue','blue','black','black','black','green','green','#CE7E00','red'],
    colorMajorTicks: ['yellow','green','blue','blue','black','black','black','black','black','black','black'],
    fontNumbersSize: "30",
	fontValueSize: "45",
	fontTitleSize: "35",
	fontUnitsSize: "45",
	value: 0,
	units: '°C',
	title: String($(this).attr('id')),
	animationRule: 'elastic',
	animationDuration: 250
}).draw());
	//console.log( String($(this).attr('id')) + ": " + $( this ).text() + $( this ).attr('id')+ " " );    units: '°C',	colorPlateEnd: "#327ac0",
});
GuageMeter={
	theme: "null",
	text: "0",
	style: "Arch",
	text_size: "0.10",
	append: "°C",
	percent: "%",
	size: 120,
	width: 10,
	back: "null",
	//label: $( this ).attr('id'),
	animate_gauge_colors: false,
	animate_text_colors:  false,
	label_color: "Blue"
	//showvalue: true
	//color: "White",
	//label_color: "White"
};


GuageMeter.label = "Влажн-ь";

GuageMeter.text_size = "0.15";
GuageMeter.append = "%";
//$(".GaugeMeter1H").gaugeMeter(GuageMeter);

GuageMeter.append = "%";
GuageMeter.label = "Кач.Возд."
//GuageMeter.back="#DCDCDC"
//$(".GaugeMeter1AQ").gaugeMeter(GuageMeter);
$(".GaugeMeterAQ").gaugeMeter(GuageMeter);
//GuageMeter.back="#DCDCDC"


$(".GaugeMeterH").gaugeMeter(GuageMeter);
//GuageMeter.back="#DCDCDC"
GuageMeter.append = "ммРт";
GuageMeter.label = "Давл-е"

GuageMeter.fill="#21B4F9";
$(".GaugeMeterP").gaugeMeter(GuageMeter);
//$(".GaugeMeter1P").gaugeMeter(GuageMeter);

// GaugeMeter1H 
GuageMeter.text = "50";
GuageMeter.append = "%";
GuageMeter.label = "Влажн-ь"
GuageMeter.theme = "Green-Gold-Red";

$(".GaugeMeter1H").gaugeMeter(GuageMeter);
//{theme:GuageMeter.theme,size:GuageMeter.size,label:GuageMeter.label,style:GuageMeter.style}
//$(".GaugeMeter1H").gaugeMeter({append:GuageMeter.append});

$(".GaugeMeter1H").each(function(index){
		console.log(("."+$(this).attr('class').split(" ")[index])+" "+("."+$(this).attr('class').split(" ")[1]));
		//GuageMeter.percent=parseInt(json_data.sensors[index+10],10);
//$($("."+$(this).attr('class').split(" ")[1])).gaugeMeter({percent:80});

//$($("."+$(this).attr('class').split(" ")[0])).gaugeMeter({append:GuageMeter.append,width:GuageMeter.width,label:GuageMeter.label,size:GuageMeter.size,text_size:GuageMeter.text_size});

$($("."+$(this).attr('class').split(" ")[1])).gaugeMeter({text:GuageMeter.text,append:GuageMeter.append,percent:50});
//$($("."+$(this).attr('class').split(" ")[1])).gaugeMeter({text:"33",percent:80});
//$($("."+$(this).attr('class').split(" ")[0])).gaugeMeter(GuageMeter);


//$($("."+$(this).attr('class').split(" ")[1])).gaugeMeter(GuageMeter);
		if(index>7)
		{return true;}
	});
	//console.log("GaugeMeter1P");
	//GuageMeterOBJ = $(".GaugeMeter1P").get();
	//console.log(GuageMeterOBJ);
/*	
	$(".GaugeMeter1P").each(function(index){
		Pdat = (parseFloat(json_data.sensors[index+17])*0.750062).toFixed(2);
		//GuageMeter.text=Pdat.toString();
		
		if(Math.round(Pdat)>750)
		{
			Pdt=750-(Pdat-750);
		}
		else if(Math.round(Pdat)<750)
		{
			Pdt=750-(750-Pdat);
		}
$($("."+$(this).attr('class').split(" ")[1])).gaugeMeter({text:Pdat.toString(),percent:33});
		console.log(33);
		if(index>3)
		{return true;}
		
});*/

	
}); 
	
window.onload = function () {

}
</script>